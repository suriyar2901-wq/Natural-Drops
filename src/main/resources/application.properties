# Server Configuration
# Bind to all network interfaces (0.0.0.0) for mobile testing
# This allows access from devices on the same Wi-Fi network
server.port=8080
server.address=0.0.0.0

# Prisma Cloud PostgreSQL Database Configuration
# SSL Mode Options:
# - prefer: Try SSL first, fallback to non-SSL if SSL fails
# - require: Require SSL but don't verify certificate (use if prefer fails)
# - verify-ca: Require SSL and verify CA certificate
# - verify-full: Require SSL and verify full certificate chain
# 
# TROUBLESHOOTING: If you get "SSL error: Connection reset":
# 1. Try changing sslmode from 'prefer' to 'require'
# 2. Check if database server is accessible: telnet db.prisma.io 5432
# 3. Verify network/firewall allows connections to db.prisma.io:5432
# 4. Check Prisma Cloud dashboard for connection string and SSL requirements
#
# Current setting: prefer (tries SSL, falls back if fails)
# If this fails, change to: sslmode=require
spring.datasource.url=jdbc:postgresql://db.prisma.io:5432/postgres?sslmode=prefer&connectTimeout=30&socketTimeout=30&tcpKeepAlive=true
spring.datasource.username=67622c1cd6a0110867322271ad9d5361399e658edf1301b6f4c41db58cd4723f
spring.datasource.password=sk_uplbdt9zWJdfHtkAWTXdd
spring.datasource.driver-class-name=org.postgresql.Driver

# Connection Pool Configuration (HikariCP)
# Increase connection timeout to handle SSL negotiation and network delays
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=600000
# CRITICAL: Disable auto-commit to allow Hibernate transaction management
spring.datasource.hikari.auto-commit=false
# Additional connection validation
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.validation-timeout=5000

# JPA/Hibernate Configuration
# Use 'create' on first run to create tables, then change to 'update'
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
# CRITICAL: Disable auto-commit for proper transaction management
# This ensures Hibernate can manage transactions correctly
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true
spring.jpa.properties.hibernate.jdbc.time_zone=UTC
# Transaction management
spring.jpa.properties.hibernate.transaction.coordinator_class=jdbc
spring.transaction.default-timeout=30

# Logging Configuration
# Root logger level
logging.level.root=INFO

# Application-specific logging
logging.level.com.naturaldrops=DEBUG
logging.level.com.naturaldrops.config=DEBUG
logging.level.com.naturaldrops.controller=DEBUG
logging.level.com.naturaldrops.service=DEBUG

# Hibernate SQL logging (can be disabled in production)
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# Spring Framework logging
logging.level.org.springframework.web=INFO
logging.level.org.springframework.security=INFO

# Console logging pattern
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} %5p [%t] %logger{36} - %msg%n

# File logging (optional - uncomment to enable file logging)
# logging.file.name=logs/application.log
# logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} %5p [%t] %logger{36} - %msg%n

# File Upload Size
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# Expo Push Notification Service 
expo.push.api.url=https://exp.host/--/api/v2/push/send

# Email Configuration (Gmail SMTP)
# IMPORTANT: To use Gmail SMTP, you must:
# 1. Enable 2-Step Verification in your Google Account
# 2. Generate an App Password (not your regular Gmail password)
#    - Go to: https://myaccount.google.com/apppasswords
#    - Generate a new app password for "Mail"
#    - Use the 16-character app password (no spaces) below
# 3. Replace the values below with your actual Gmail and app password
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=natruraldrops@gmail.com
spring.mail.password=cncovgigyfjczbvj
# ⚠️ IMPORTANT: Gmail App Password - remove all spaces!
# The password above should be 16 characters with NO spaces.
# If you get authentication errors, verify:
# 1. 2-Step Verification is enabled
# 2. App Password is generated from: https://myaccount.google.com/apppasswords
# 3. No spaces in the password (remove all spaces)
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true
spring.mail.properties.mail.smtp.connectiontimeout=5000
spring.mail.properties.mail.smtp.timeout=5000
spring.mail.properties.mail.smtp.writetimeout=5000
# Additional Gmail-specific properties
spring.mail.properties.mail.smtp.ssl.trust=smtp.gmail.com
spring.mail.properties.mail.smtp.ssl.protocols=TLSv1.2
# Disable SSL verification (only for development - remove in production)
spring.mail.properties.mail.smtp.ssl.checkserveridentity=false
# Enable debug logging for email (set to false in production)
spring.mail.properties.mail.debug=false

# Frontend URL Configuration (for email links)
# This should point to your React Native web frontend URL
# For web: http://localhost:8081 (or your Expo web port)
# For production: https://your-domain.com
app.base-url=http://localhost:8081

# JWT Configuration
# Secret key for JWT signing (minimum 256 bits / 32 characters for HS256)
# IMPORTANT: Change this to a secure random string in production
jwt.secret=naturaldrops-secret-key-change-in-production-minimum-256-bits-for-security
# Access token expiration (2 hours in milliseconds = 7200000)
# Increased from 15 minutes to improve user experience
jwt.access-token-expiration=7200000
# Refresh token expiration (7 days in milliseconds = 604800000)
# Increased from 2.5 hours for better session management
jwt.refresh-token-expiration=604800000
# Clock skew tolerance (5 minutes in milliseconds = 300000)
# Allows tokens to be accepted if expired within this window (handles time sync issues)
jwt.clock-skew-tolerance=300000

